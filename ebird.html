<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ebird</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="ebird_files/libs/clipboard/clipboard.min.js"></script>
<script src="ebird_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="ebird_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="ebird_files/libs/quarto-html/popper.min.js"></script>
<script src="ebird_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ebird_files/libs/quarto-html/anchor.min.js"></script>
<link href="ebird_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ebird_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ebird_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ebird_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ebird_files/libs/bootstrap/bootstrap-81267100e462c21b3d6c0d5bf76a3417.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<section id="sec-ebird" class="level1">
<h1>Best Practices for using eBird Data</h1>
<p>En este capítulo, destacaremos algunos de los desafíos asociados con el uso de datos de eBird. Luego mostraremos cómo importar los datos en R, aplicar filtros y usar listas completas para producir datos de detección/no detección adecuados para modelar la distribución y abundancia de especies. Finalmente, realizaremos algunos pasos de pre-procesamiento necesarios para asegurar el análisis apropiado de los datos.<br>
Usamos los términos&nbsp;<strong>detección</strong>&nbsp;y&nbsp;<strong>no detección</strong>&nbsp;en lugar de los términos más comunes&nbsp;<strong>presencia</strong>&nbsp;y&nbsp;<strong>ausencia</strong>&nbsp;a lo largo de esta guía para reflejar el hecho de que un conteo inferido de cero no necesariamente significa que una especie está ausente, solo que no fue detectada en la lista en cuestión.</p>
<section id="desafíos-asociados-con-datos-de-ebird" class="level2">
<h2 class="anchored" data-anchor-id="desafíos-asociados-con-datos-de-ebird">Desafíos asociados con datos de eBird</h2>
<p>A pesar de las fortalezas de los datos de eBird, las observaciones de especies recolectadas a través de proyectos de ciencia ciudadana presentan una serie de desafíos que no se encuentran en datos científicos convencionales. Alguno de los siguientes desafíos asociados con estos datos que serán abordados a lo largo de este curso son:</p>
<ul>
<li><p><strong>Sesgo taxonómico</strong>: los participantes a menudo tienen preferencias por ciertas especies, lo que puede llevar a un registro preferencial de algunas especies sobre otras (<a href="references.html#ref-greenwoodCitizensScienceBird2007">Greenwood 2007</a>; <a href="#0">Tulloch and Szabo 2012</a>). Restringir los análisis a listas completas mitiga en gran medida este problema.</p></li>
<li><p><strong>Sesgo espacial</strong>: la mayoría de los participantes en proyectos de ciencia ciudadana muestrean cerca de sus hogares (<a href="references.html#ref-luckAlleviatingSpatialConflict2004">Luck et al.&nbsp;2004</a>), en áreas de fácil acceso como bordes de carreteras (<a href="references.html#ref-kadmonEffectRoadsideBias2004">Kadmon, Farber, and Danin 2004</a>), o en áreas y hábitats de alta biodiversidad conocida (<a href="references.html#ref-prendergastCorrectingVariationRecording1993">Prendergast et al.&nbsp;1993</a>). Un método simple para reducir el sesgo espacial es crear una grilla sobre la región de interés y muestrear un número determinado de listas desde cada celda de la grilla.</p></li>
<li><p><strong>Sesgo temporal</strong>: los participantes muestrean preferentemente cuando están disponibles, como los fines de semana (<a href="references.html#ref-courterWeekendBiasCitizen2013">Courter et al.&nbsp;2013</a>), y en épocas del año cuando esperan observar más aves; notablemente, en Estados Unidos hay un gran aumento en envíos de eBird durante la migración de primavera (<a href="references.html#ref-sullivanEBirdEnterpriseIntegrated2014">Sullivan et al.&nbsp;2014</a>). Además, eBird ha aumentado constantemente en popularidad con el tiempo, lo que lleva a un fuerte sesgo hacia más datos en años recientes. Para abordar el sesgo de fin de semana, recomendamos usar una escala temporal de una semana o varias semanas para la mayoría de los análisis. Los sesgos temporales a escalas más largas pueden abordarse submuestreando los datos para producir una distribución temporal más uniforme.</p></li>
<li><p><strong>Desbalance de clases</strong>: las especies de aves que son raras o difíciles de detectar pueden tener datos con alto desbalance de clases, con muchas más listas con no detecciones que con detecciones. Para estas especies, un modelo de distribución que predice que la especie está ausente en todas partes tendrá alta precisión, pero ningún valor ecológico. Seguiremos los métodos para abordar el desbalance de clases propuestos por Robinson et al.&nbsp;(<a href="references.html#ref-robinsonUsingCitizenScience2018">2018</a>), muestreando los datos para aumentar artificialmente la prevalencia de detecciones antes del modelado.</p></li>
<li><p><strong>Precisión espacial</strong>: la ubicación espacial de una lista de eBird se proporciona como un único punto latitud-longitud; sin embargo, esto puede no ser preciso por dos razones principales. Primero, para listas en tránsito, esta ubicación representa solo un punto en el recorrido. Segundo, las listas de eBird a menudo se asignan a un hotspot (una ubicación común para todos los observadores que visitan un sitio popular) en lugar de su ubicación verdadera. Por estas razones, no es apropiado alinear las ubicaciones de eBird con variables de hábitat muy precisas, y recomendamos resumir variables dentro de un vecindario alrededor de la ubicación de la lista.</p></li>
<li><p><strong>Variación en detectabilidad/esfuerzo</strong>: la detectabilidad describe la probabilidad de que una especie este presente en un área y sea detectada e identificada. La detectabilidad varía según la estación, hábitat y especie (<a href="references.html#ref-johnstonSpeciesTraitsExplain2014">Johnston et al.&nbsp;2014</a>,&nbsp;<a href="references.html#ref-johnstonEstimatesObserverExpertise2018">2018</a>). Además, los datos de eBird se recolectan con alta variación en esfuerzo, hora del día, número de observadores y condiciones externas como el clima, todo lo cual puede afectar la detectabilidad de las especies (<a href="references.html#ref-ellisEffectsWeatherTime2018">Ellis and Taylor 2018</a>;&nbsp;<a href="references.html#ref-oliveiraObservationDiurnalSoaring2018">Oliveira et al.&nbsp;2018</a>). Por lo tanto, la detectabilidad es particularmente importante de considerar al comparar entre estaciones, hábitats o especies. Dado que eBird usa un protocolo semi-estructurado que recolecta datos sobre el proceso de observación, podremos controlar una mayor proporción de esta variación en nuestros análisis.</p></li>
</ul>
<p>El resto de esta guía demostrará cómo abordar estos desafíos usando datos reales de eBird para producir estimaciones confiables de distribuciones de especies. En general, tomaremos un enfoque de dos frentes para lidiar con datos no estructurados y maximizar el valor de los datos de ciencia ciudadana: <strong>imponer más estructura en los datos mediante filtrado</strong> e <strong>incluir variables predictoras que describan el proceso de observación</strong> en nuestros modelos para controlar la variación restante.</p>
</section>
<section id="sec-ebird-import" class="level2">
<h2 class="anchored" data-anchor-id="sec-ebird-import">Importar datos de eBird en R</h2>
<p>La clase anterior aprendimos a descargar datos desde eBird, obteniendo dos archivos de texto separados por tabulaciones, uno para el EBD (datos de observación) y uno para el SED (datos de lista). Ahora, iniciaremos un nuevo proyecto de RStudio y agregaremos los dos archivos de texto descargados en el subdirectorio&nbsp;<code>data/</code>&nbsp;del directorio del proyecto.</p>
<p>El paquete de R <code>auk</code> está diseñado específicamente para trabajar con datos de eBird. Incluye las funciones <a href="https://cornelllabofornithology.github.io/auk/reference/read_ebd.html"><code>read_ebd()</code></a> and <a href="https://cornelllabofornithology.github.io/auk/reference/read_ebd.html"><code>read_sampling()</code></a> para importar el EBD y SED, respectivamente, en R.</p>
<p>Primero vamos a importar los datos de listas (SED).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(auk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>auk 0.8.0 is designed for EBD files downloaded after 2024-10-29. 
No EBD data directory set, see ?auk_set_ebd_path to set EBD_PATH 
eBird taxonomy version:  2024</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'lubridate'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    date, intersect, setdiff, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Linking to GEOS 3.13.0, GDAL 3.8.5, PROJ 9.5.1; sf_use_s2() is TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>f_sed <span class="ot">&lt;-</span> <span class="st">"data/ebd_CL-LL_chutap1_smp_relSep-2025_sampling.txt"</span> <span class="co"># aquí debemos ajustar el nombre del archivo si trabajaremos con una descarga personal</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>checklists <span class="ot">&lt;-</span> <span class="fu">read_sampling</span>(f_sed, <span class="at">unique =</span> <span class="cn">FALSE</span>) <span class="co"># leemos el archivo y generamos un objeto que contenga toda la información de las listas</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(checklists) <span class="co"># vemos un resumen rápido del objeto generado con la base de datos</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 135,787
Columns: 33
$ last_edited_date          &lt;chr&gt; "2023-03-08 18:35:28.525811", "2023-03-08 18…
$ country                   &lt;chr&gt; "Chile", "Chile", "Chile", "Chile", "Chile",…
$ country_code              &lt;chr&gt; "CL", "CL", "CL", "CL", "CL", "CL", "CL", "C…
$ state                     &lt;chr&gt; "Los Lagos", "Los Lagos", "Los Lagos", "Los …
$ state_code                &lt;chr&gt; "CL-LL", "CL-LL", "CL-LL", "CL-LL", "CL-LL",…
$ county                    &lt;chr&gt; "Puerto Montt", "Curaco de Vélez", "Puerto V…
$ county_code               &lt;chr&gt; "CL-LL-OMO", "CL-LL-CUR", "CL-LL-OVA", "CL-L…
$ iba_code                  &lt;chr&gt; NA, "BIRDLIFE_26907", NA, NA, NA, NA, NA, NA…
$ bcr_code                  &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ usfws_code                &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ atlas_block               &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ locality                  &lt;chr&gt; "piedra azul", "Curaco de Vélez--Humedales d…
$ locality_id               &lt;chr&gt; "L19884201", "L20235644", "L20552704", "L205…
$ locality_type             &lt;chr&gt; "P", "H", "P", "P", "P", "H", "H", "H", "H",…
$ latitude                  &lt;dbl&gt; -41.48505, -42.44082, -41.31394, -42.94442, …
$ longitude                 &lt;dbl&gt; -72.82296, -73.60578, -72.89492, -73.61935, …
$ observation_date          &lt;date&gt; 2019-08-15, 2019-01-24, 2019-02-16, 2019-02…
$ time_observations_started &lt;chr&gt; "08:00:00", "10:00:00", "17:08:00", "10:04:0…
$ observer_id               &lt;chr&gt; "obsr2818200", "obsr1166222", "obsr279749", …
$ observer_orcid_id         &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ sampling_event_identifier &lt;chr&gt; "S114001497", "S118804608", "S116936975", "S…
$ observation_type          &lt;chr&gt; "Stationary", "Traveling", "Stationary", "St…
$ protocol_name             &lt;chr&gt; "Stationary", "Traveling", "Stationary", "St…
$ protocol_code             &lt;chr&gt; "P21", "P22", "P21", "P21", "P20", "P22", "P…
$ project_names             &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ project_identifiers       &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ duration_minutes          &lt;int&gt; 480, 60, 5, 10, NA, 46, 36, 39, 12, 38, 124,…
$ effort_distance_km        &lt;dbl&gt; NA, 1.000, NA, NA, NA, 0.253, 1.350, 0.270, …
$ effort_area_ha            &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ number_observers          &lt;int&gt; 1, 1, 1, 1, NA, 4, 5, 4, 4, 4, 7, 3, 7, 4, 3…
$ all_species_reported      &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, FALSE, TRUE, TRUE, T…
$ group_identifier          &lt;chr&gt; NA, NA, NA, NA, NA, "G4267503", "G4594512", …
$ checklist_comments        &lt;chr&gt; "observada desde mi ventan en carretera aust…</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Checkpoint
</div>
</div>
<div class="callout-body-container callout-body">
<p>Tómate un tiempo para explorar las variables en el conjunto de datos de listas. Si no estás seguro acerca de alguna de las variables, puedes consultar el documento pdf de metadatos que viene con la descarga de datos (<code>eBird_BaeBird_Basic_Dataset_Metadata_v1.16.pdf</code>) o con la versión en español que puedes encontrar en la carpeta drive del curso (<code>Manual-de-uso-base-de-datos-eBird-Chile-version-agosto-2025.pdf</code>).</p>
</div>
</div>
<p>Para algunas aplicaciones, solo se requieren los datos de listas. Por ejemplo, los datos de listas se pueden usar para investigar la distribución espacial y temporal de datos eBird dentro de una región. Este conjunto de datos también puede ser útil para explorar cuánta variación hay en las variables de esfuerzo de observación e identificar listas que tienen baja precisión espacial o temporal.</p>
<div class="callout callout-style-default callout-caution no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Ejercicio
</div>
</div>
<div class="callout-body-container callout-body">
<p>Realiza un histograma que muestre la distribución de las distancias recorridas en las listas (checklist) con protocolo “con desplazamiento”.</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solución
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Casi el 90% de las listas tienen menos de 10 km de longitud; sin embargo, algunas listas alcanzan hasta los 80 km en distancia. Las listas de verificación con largas distancias de viaje tienen una presición espacial menor, por lo que no suelen usarse en ciertos análisis y por lo tanto se eliminan antes de este.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>checklists_traveling <span class="ot">&lt;-</span> <span class="fu">filter</span>(checklists, protocol_name <span class="sc">==</span> <span class="st">"Traveling"</span>) <span class="co">#Aquí filtramos por el tipo de protocolo, en este caso, "con desplazamiento"</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(checklists_traveling) <span class="sc">+</span>  <span class="co"># objeto con datos que queremos graficar</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> effort_distance_km) <span class="sc">+</span> <span class="co"># variable que queremos en el eje x (distancia recorrida)</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">5</span>) <span class="sc">+</span> <span class="co"># ancho de los intervalos del histograma</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>), <span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span> <span class="co"># ajustamos el eje y para que comience en 0 y formateamos los números con separador de miles</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Distance traveled [km]"</span>, <span class="co"># etiqueta del eje x</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"# of eBird checklists"</span>, <span class="co"># etiqueta del eje y</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Distribución de la distancia recorrida en las listas de eBird"</span>) <span class="co"># título del gráfico</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 71 rows containing non-finite outside the scale range
(`stat_bin()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ebird_files/figure-html/ebird-import-distance-sol-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Posiblemente notaron que en el ejercicio anterior les apareció la advertencia “Removed 71 rows containing non-finite outside the scale range (<code>stat_bin()</code>).”. Este aviso nos indica que 71 filas de nuestra base de datos no fueron consideradas para el histograma porque el valor de <code>effort_distance_km</code> es no finito (<code>NA</code>, <code>NaN</code> o <code>Inf</code>). Esto no es grave, podemos revisar que ocurre con esas listas y corregir en caso de que sea necesario.</p>
<p>Ahora, importemos los datos de observación (EBD).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>f_ebd <span class="ot">&lt;-</span> <span class="st">"data/ebd_CL-LL_chutap1_smp_relSep-2025.txt"</span> <span class="co">#Aquí debemos ajustar el nombre del archivo si trabajaremos con una descarga personal</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>observations <span class="ot">&lt;-</span> <span class="fu">read_ebd</span>(f_ebd, <span class="at">unique =</span> <span class="cn">FALSE</span>, <span class="at">rollup =</span> <span class="cn">FALSE</span>) <span class="co"># leemos el archivo y generamos un objeto que contenga toda la información de las listas</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(observations) <span class="co"># resumen rápido del objeto generado</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 21,792
Columns: 52
$ global_unique_identifier   &lt;chr&gt; "URN:CornellLabOfOrnithology:EBIRD:OBS22384…
$ last_edited_date           &lt;chr&gt; "2024-10-14 12:41:13.045987", "2023-03-08 1…
$ taxonomic_order            &lt;int&gt; 14232, 14232, 14232, 14232, 14232, 14232, 1…
$ category                   &lt;chr&gt; "species", "species", "species", "species",…
$ taxon_concept_id           &lt;chr&gt; "avibase-23178B5E", "avibase-23178B5E", "av…
$ common_name                &lt;chr&gt; "Chucao Tapaculo", "Chucao Tapaculo", "Chuc…
$ scientific_name            &lt;chr&gt; "Scelorchilus rubecula", "Scelorchilus rube…
$ subspecies_common_name     &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ subspecies_scientific_name &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ exotic_code                &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ observation_count          &lt;chr&gt; "2", "1", "1", "1", "2", "4", "1", "3", "1"…
$ breeding_code              &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ breeding_category          &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ behavior_code              &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ age_sex                    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ country                    &lt;chr&gt; "Chile", "Chile", "Chile", "Chile", "Chile"…
$ country_code               &lt;chr&gt; "CL", "CL", "CL", "CL", "CL", "CL", "CL", "…
$ state                      &lt;chr&gt; "Los Lagos", "Los Lagos", "Los Lagos", "Los…
$ state_code                 &lt;chr&gt; "CL-LL", "CL-LL", "CL-LL", "CL-LL", "CL-LL"…
$ county                     &lt;chr&gt; "Ancud", "Ancud", "Ancud", "Ancud", "Ancud"…
$ county_code                &lt;chr&gt; "CL-LL-ANC", "CL-LL-ANC", "CL-LL-ANC", "CL-…
$ iba_code                   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ bcr_code                   &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ usfws_code                 &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ atlas_block                &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ locality                   &lt;chr&gt; "Chiloe Island, first year, Rodrigo's", "Ch…
$ locality_id                &lt;chr&gt; "L2501072", "L2501072", "L2501072", "L25010…
$ locality_type              &lt;chr&gt; "P", "P", "P", "P", "P", "P", "P", "P", "P"…
$ latitude                   &lt;dbl&gt; -41.87506, -41.87506, -41.87506, -41.87506,…
$ longitude                  &lt;dbl&gt; -73.53378, -73.53378, -73.53378, -73.53378,…
$ observation_date           &lt;date&gt; 1994-10-25, 1994-11-08, 1994-11-26, 1994-1…
$ time_observations_started  &lt;chr&gt; "07:30:00", "07:30:00", "07:30:00", "07:30:…
$ observer_id                &lt;chr&gt; "obsr213338", "obsr213338", "obsr213338", "…
$ observer_orcid_id          &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ sampling_event_identifier  &lt;chr&gt; "S16187694", "S16187936", "S16188333", "S16…
$ observation_type           &lt;chr&gt; "Traveling", "Traveling", "Traveling", "Tra…
$ protocol_name              &lt;chr&gt; "Traveling", "Traveling", "Traveling", "Tra…
$ protocol_code              &lt;chr&gt; "P22", "P22", "P22", "P22", "P22", "P22", "…
$ project_names              &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ project_identifiers        &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ duration_minutes           &lt;int&gt; 120, 240, 180, 300, 240, 300, 240, 300, 10,…
$ effort_distance_km         &lt;dbl&gt; 8.047, 8.047, 6.437, 8.047, 8.047, 8.047, 3…
$ effort_area_ha             &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ number_observers           &lt;int&gt; 2, 2, 3, 2, 2, 2, 6, 2, 1, 2, 1, 3, 1, 3, 3…
$ all_species_reported       &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, T…
$ group_identifier           &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ has_media                  &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, F…
$ approved                   &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, T…
$ reviewed                   &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, F…
$ reason                     &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ checklist_comments         &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ species_comments           &lt;chr&gt; "courtship", "first nest! Chucao in &amp; out, …</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Checkpoint
</div>
</div>
<div class="callout-body-container callout-body">
<p>Tómate un tiempo para explorar las variables en el conjunto de datos de observación. Observa que el EBD duplica muchas de las variables a nivel de lista del SED.</p>
</div>
</div>
<p>Cuando leemos los datos en R, usamos <code>unique = FALSE</code> y <code>rollup = FALSE</code>. Por defecto, las funciones de lectura en el paquete <code>auk</code> realizan dos pasos importantes de preprocesamiento: combinar listas compartidas duplicadas y consolidación taxonómica. Intencionalmente desactivamos esta funcionalidad con fines demostrativos.</p>
<section id="sec-ebird-import-shared" class="level3">
<h3 class="anchored" data-anchor-id="sec-ebird-import-shared">Listas compartidas</h3>
<p>eBird permite a los usuarios <a href="https://support.ebird.org/en/support/solutions/articles/48000625567-checklist-sharing-and-group-accounts#anchorShareChecklists">compartir listas</a> de verificación con otros observadores de su grupo, por ejemplo, <a href="https://ebird.org/checklist/S50445806">esta lista</a> es compartida por 10 observadores. Estas listas se pueden identificar mirando la variable <code>group_identifier</code>, que asigna un ID que conecta todas las listas del grupo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>checklists <span class="sc">%&gt;%</span>  <span class="co"># colocamos el objeto con el que queremos trabajar, en este caso la base de datos de los listados</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(group_identifier)) <span class="sc">%&gt;%</span> <span class="co"># filtramos para quedarnos solo con las filas que presenten un ID de grupo </span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(group_identifier) <span class="sc">%&gt;%</span> <span class="co"># ordenamos las filas filtradas de menor a mayor, esto facilita la observación </span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sampling_event_identifier, group_identifier) <span class="co"># seleccionamos solo las columnas 'sampling_event_identifier' y 'group_identifier' para reducir la información a lo que necesitamos</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 59,623 × 2
   sampling_event_identifier group_identifier
   &lt;chr&gt;                     &lt;chr&gt;           
 1 S133813900                G10000814       
 2 S133813899                G10000814       
 3 S133818644                G10001020       
 4 S133818643                G10001020       
 5 S133827106                G10001448       
 6 S133962903                G10001448       
 7 S133838666                G10002009       
 8 S133838667                G10002009       
 9 S133838814                G10002021       
10 S133838815                G10002021       
# ℹ 59,613 more rows</code></pre>
</div>
</div>
<p>Las listas con el mismo <code>group_identifier</code> proporcionan información duplicada sobre el mismo evento de observación de aves en la base de datos. Para la mayoría de los análisis, es importante contraer estas listas de verificación compartidas en una sola lista de verificación. Esto se puede lograr con la función <a href="https://cornelllabofornithology.github.io/auk/reference/auk_unique.html">auk_unique()</a>, que conserva solo una copia independiente de cada lista.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>checklists_unique <span class="ot">&lt;-</span> <span class="fu">auk_unique</span>(checklists, <span class="at">checklists_only =</span> <span class="cn">TRUE</span>) <span class="co"># generamos un nuevo objeto que contenga solo una copia independiente de cada lista</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(checklists) <span class="co"># número de filas en el objeto original</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 135787</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(checklists_unique) <span class="co"># número de filas en el nuevo objeto</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 99730</code></pre>
</div>
</div>
<p>Observe que se creó una nueva variable, <code>checklist_id</code>, que toma el valor de <code>group_identifier</code> para listas compartidas y de <code>sampling_event_identifier</code> para listas no compartidas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(checklists_unique<span class="sc">$</span>checklist_id) <span class="co"># vemos los primeros seis valores de la columna checklist_id</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "S114001497" "S118804608" "S116936975" "S116936842" "S116974914"
[6] "S53230567" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(checklists_unique<span class="sc">$</span>checklist_id) <span class="co"># vemos los ultimos seis valores de la columna checklist_id</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "G7616152" "G7628777" "G7626514" "G7634837" "G7636811" "G7637068"</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>¿Tienes curiosidad por saber qué listas y observadores contribuyeron a una lista compartida después de que se haya colapsado? El <code>sample_event_identifier</code> y el <code>observador_id</code> contienen listas separadas por comas de todas las listas y observadores que contribuyeron a las listas compartidas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>checklists_unique <span class="sc">%&gt;%</span> <span class="co"># del objeto que no contiene duplicado</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(checklist_id <span class="sc">==</span> <span class="st">"G10045560"</span>) <span class="sc">%&gt;%</span> <span class="co"># filtramos las filas que correspondan a las listas del grupo "G10045560"</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(checklist_id, group_identifier, sampling_event_identifier, observer_id) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
  checklist_id group_identifier sampling_event_identifier            observer_id
  &lt;chr&gt;        &lt;chr&gt;            &lt;chr&gt;                                &lt;chr&gt;      
1 G10045560    G10045560        S134565230,S134565692,S134660967,S1… obsr199389…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># seleccionamos solo las columnas que nos interesan para saber que listas y observadores contribuyeron en la observación </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="sec-ebird-import-rollup" class="level3">
<h3 class="anchored" data-anchor-id="sec-ebird-import-rollup">Rollup taxonómico</h3>
<p>Las observaciones de eBird se pueden hacer a niveles por debajo de especie (por ejemplo, subespecie) o por encima de especie (por ejemplo, un ave que fue identificada como un pato, pero no se pudo determinar la especie); sin embargo, para la mayoría de los usos querremos observaciones a nivel de especie. Esto es especialmente cierto si queremos producir datos de detección/no detección a partir de listas completas, porque “completo” solo aplica a nivel de especie.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>En el conjunto de datos de ejemplo utilizado para este curso, estos problemas taxonómicos no se aplican. Hemos solicitado observaciones de chucao, por lo que no hemos recibido ninguna observación de taxones por encima de la especie, ni tampoco subespecies. Sin embargo, en muchas otras situaciones, estos problemas taxonómicos pueden ser importantes. Por ejemplo, <a href="https://ebird.org/checklist/S109437960">esta lista</a> tiene 1 tijeral común y 1 tijeral común (aegithaloides). <code>auk_rollup()</code> combina las dos observaciones en una sola observación de tijeral común.</p>
</div>
</div>
<p>La función <a href="https://cornelllabofornithology.github.io/auk/reference/auk_rollup.html">auk_rollup()</a> elimina todas las observaciones no identificables a nivel de especie y consolida todas las observaciones reportadas por debajo de especie al nivel de especie.</p>
<p>Para este ejercicio trabajaremos con el tijeral, por lo que antes de realizar el rollup debemos cargar la base de datos del tijeral en Chile (<code>ebd_CL_pmtspi1_smp_relSep-2025.txt</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>ft_ebd <span class="ot">&lt;-</span> <span class="st">"data/ebd_CL_pmtspi1_smp_relSep-2025.txt"</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>tijeral <span class="ot">&lt;-</span> <span class="fu">read_ebd</span>(f_ebd, <span class="at">unique =</span> <span class="cn">FALSE</span>, <span class="at">rollup =</span> <span class="cn">FALSE</span>) </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>observations_rollup <span class="ot">&lt;-</span> <span class="fu">auk_rollup</span>(tijeral)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># uno de los ejemplos, revisamos la lista antes del rollup y comparamos con como queda la información luego del rollup. </span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>tijeral <span class="sc">%&gt;%</span> </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sampling_event_identifier <span class="sc">==</span> <span class="st">"S109437960"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sampling_event_identifier, common_name, subspecies_common_name, </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>         observation_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 4
# ℹ 4 variables: sampling_event_identifier &lt;chr&gt;, common_name &lt;chr&gt;,
#   subspecies_common_name &lt;chr&gt;, observation_count &lt;chr&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>observations_rollup <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sampling_event_identifier <span class="sc">==</span> <span class="st">"S109437960"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sampling_event_identifier, common_name,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>         observation_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 0 × 3
# ℹ 3 variables: sampling_event_identifier &lt;chr&gt;, common_name &lt;chr&gt;,
#   observation_count &lt;chr&gt;</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Si múltiples taxones en una sola lista se consolidan a la misma especie, <code>auk_rollup()</code> intenta combinarlos inteligentemente. Si cada observación tiene un conteo, esos conteos se suman, pero si alguna de las observaciones carece de conteo (es decir, el conteo es “X”) la observación combinada también recibe una “X”. En la&nbsp;<a href="https://ebird.org/checklist/S109437960">lista de ejemplo</a>&nbsp;del Tip anterior, con dos taxones consolidándose a tijeral común, <code>auk_rollup()</code> suma los dos conteos para obtener 2 tijeral común (1 + 1).</p>
</div>
</div>
</section>
</section>
<section id="sec-ebird-zf" class="level2">
<h2 class="anchored" data-anchor-id="sec-ebird-zf">Generación de datos de detección/no detección</h2>
<p>Las listas completas de eBird son extremadamente valiosas porque, para todas las especies que no fueron reportadas, podemos inferir conteos de 0. Esto nos permite convertir datos de solo presencia a datos de detección/no detección, lo que nos permite realizar análisis mucho más robustos. Ten en cuenta que no usamos el término presencia/ausencia, porque una no detección no necesariamente implica que la especie estuvo ausente, solo que el observador no la detectó e identificó.</p>
<p>Nos referimos al proceso de producir datos de detección/no detección como “llenar con ceros” los datos de eBird (zero-filling), porque estamos llenando los ceros faltantes. Leeremos los datos de eBird en R nuevamente, y filtraremos solo las listas completas. Luego, usaremos la función <a href="https://cornelllabofornithology.github.io/auk/reference/auk_zerofill.html"><code>auk_zerofill()</code></a> para generar datos de detección/no detección. Ten en cuenta que las listas compartidas se combinan y la consolidación taxonómica se realiza por defecto al usar las funciones <code>read_*()</code> de <code>auk</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># importamos los datos de los listados (SED) </span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>checklists <span class="ot">&lt;-</span> <span class="fu">read_sampling</span>(f_sed) <span class="sc">%&gt;%</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># seleccionamos solo los listados completos</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(all_species_reported)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># importamos los datos de observación (EBD)</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>observations <span class="ot">&lt;-</span> <span class="fu">read_ebd</span>(f_ebd) <span class="sc">%&gt;%</span> </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># seleccionamos solo los listados completos</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(all_species_reported)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co"># uso de la función zero-fill para generar los datos de detección/no detección</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>zf <span class="ot">&lt;-</span> <span class="fu">auk_zerofill</span>(observations, checklists, <span class="at">collapse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(zf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 80,577
Columns: 41
$ checklist_id              &lt;chr&gt; "S114001497", "S118804608", "S116936975", "S…
$ last_edited_date          &lt;chr&gt; "2023-03-08 18:35:28.525811", "2023-03-08 18…
$ country                   &lt;chr&gt; "Chile", "Chile", "Chile", "Chile", "Chile",…
$ country_code              &lt;chr&gt; "CL", "CL", "CL", "CL", "CL", "CL", "CL", "C…
$ state                     &lt;chr&gt; "Los Lagos", "Los Lagos", "Los Lagos", "Los …
$ state_code                &lt;chr&gt; "CL-LL", "CL-LL", "CL-LL", "CL-LL", "CL-LL",…
$ county                    &lt;chr&gt; "Puerto Montt", "Curaco de Vélez", "Puerto V…
$ county_code               &lt;chr&gt; "CL-LL-OMO", "CL-LL-CUR", "CL-LL-OVA", "CL-L…
$ iba_code                  &lt;chr&gt; NA, "BIRDLIFE_26907", NA, NA, NA, NA, NA, NA…
$ bcr_code                  &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ usfws_code                &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ atlas_block               &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ locality                  &lt;chr&gt; "piedra azul", "Curaco de Vélez--Humedales d…
$ locality_id               &lt;chr&gt; "L19884201", "L20235644", "L20552704", "L205…
$ locality_type             &lt;chr&gt; "P", "H", "P", "P", "H", "H", "H", "H", "H",…
$ latitude                  &lt;dbl&gt; -41.48505, -42.44082, -41.31394, -42.94442, …
$ longitude                 &lt;dbl&gt; -72.82296, -73.60578, -72.89492, -73.61935, …
$ observation_date          &lt;date&gt; 2019-08-15, 2019-01-24, 2019-02-16, 2019-02…
$ time_observations_started &lt;chr&gt; "08:00:00", "10:00:00", "17:08:00", "10:04:0…
$ observer_id               &lt;chr&gt; "obsr2818200", "obsr1166222", "obsr279749", …
$ observer_orcid_id         &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ sampling_event_identifier &lt;chr&gt; "S114001497", "S118804608", "S116936975", "S…
$ observation_type          &lt;chr&gt; "Stationary", "Traveling", "Stationary", "St…
$ protocol_name             &lt;chr&gt; "Stationary", "Traveling", "Stationary", "St…
$ protocol_code             &lt;chr&gt; "P21", "P22", "P21", "P21", "P62", "P22", "P…
$ project_names             &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ project_identifiers       &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ duration_minutes          &lt;int&gt; 480, 60, 5, 10, NA, 19, 22, 30, 23, 132, 2, …
$ effort_distance_km        &lt;dbl&gt; NA, 1.000, NA, NA, NA, 0.308, 1.850, NA, 3.2…
$ effort_area_ha            &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ number_observers          &lt;int&gt; 1, 1, 1, 1, 3, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1,…
$ all_species_reported      &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TR…
$ group_identifier          &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ checklist_comments        &lt;chr&gt; "observada desde mi ventan en carretera aust…
$ scientific_name           &lt;chr&gt; "Scelorchilus rubecula", "Scelorchilus rubec…
$ breeding_code             &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ breeding_category         &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ behavior_code             &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ age_sex                   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ observation_count         &lt;chr&gt; "0", "0", "0", "0", "0", "0", "0", "0", "0",…
$ species_observed          &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FA…</code></pre>
</div>
</div>
<p>La variable <code>observation_count</code> tiene conteos verdaderos así como también “X”, estas indican que la especie fue detectada pero no se contó el número de individuos. <code>auk_zerofill()</code> agrega una nueva columna binaria, <code>species_observed</code>, indicando si la especie fue detectada o no.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(zf, observation_count, species_observed) <span class="sc">%&gt;%</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="co"># observamos los primero 10 valores de las columnas con conteos y si se detectó la especie o no</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   observation_count species_observed
   &lt;chr&gt;             &lt;lgl&gt;           
 1 0                 FALSE           
 2 0                 FALSE           
 3 0                 FALSE           
 4 0                 FALSE           
 5 0                 FALSE           
 6 0                 FALSE           
 7 0                 FALSE           
 8 0                 FALSE           
 9 0                 FALSE           
10 0                 FALSE           </code></pre>
</div>
</div>
<p>Convirtamos las “X” en NAs y transformemos <code>observation_count</code> en una variable entera.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>zf<span class="sc">$</span>observation_count <span class="ot">&lt;-</span> <span class="fu">if_else</span>(zf<span class="sc">$</span>observation_count <span class="sc">==</span> <span class="st">"X"</span>, </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                                <span class="cn">NA_character_</span>, zf<span class="sc">$</span>observation_count) <span class="sc">%&gt;%</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.integer</span>()</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(zf, observation_count, species_observed) <span class="sc">%&gt;%</span> </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   observation_count species_observed
               &lt;int&gt; &lt;lgl&gt;           
 1                 0 FALSE           
 2                 0 FALSE           
 3                 0 FALSE           
 4                 0 FALSE           
 5                 0 FALSE           
 6                 0 FALSE           
 7                 0 FALSE           
 8                 0 FALSE           
 9                 0 FALSE           
10                 0 FALSE           </code></pre>
</div>
</div>
</section>
<section id="sec-ebird-filtering" class="level2">
<h2 class="anchored" data-anchor-id="sec-ebird-filtering">Filtrado de datos</h2>
<p>Ahora que tienes un conjunto de datos de detección/no detección, es probable que quieras hacer algo con él. Por ejemplo, puedes querer hacer un mapa, identificar áreas prioritarias para una especie o entrenar un modelo de distribución de especies. Independientemente de la aplicación específica, es probable que primero se requiera algún filtrado de los datos. Algunas de las formas en que puedes querer filtrar los datos de eBird incluyen:</p>
<ul>
<li><strong>Filtrado temporal</strong>: filtrar los datos a un rango específico de años o a una época específica del año.</li>
<li><strong>Filtrado espacial</strong>: filtrar los datos para enfocarse en una región específica, por ejemplo, un área protegida.</li>
<li><strong>Aumento de la precisión</strong>: algunas listas de eBird son bastante largas en distancia o duración, lo que lleva a imprecisión espacial o temporal. Al eliminar listas más largas podemos aumentar la precisión espacial del conjunto de datos.</li>
<li><strong>Reducción de la variación en el esfuerzo</strong>: a diferencia de los estudios científicos estructurados, los datos se pueden enviar a eBird usando una variedad de protocolos y hay una variación significativa en el esfuerzo entre listas en el conjunto de datos de eBird. La variación en el protocolo y el esfuerzo conduce a variación en la detectabilidad (más esfuerzo generalmente conduce a mayor detectabilidad). Podemos elegir imponer más estructura en el conjunto de datos de eBird filtrando para reducir la variación en protocolo y esfuerzo.</li>
</ul>
<p>The specific filtering you apply will depend on how you intend to use the eBird data. However, for the sake of this example, let’s filter the eBird data to only traveling and stationary checklists from 2013-2022 that are less than 6 hours in duration and 10 km in length.</p>
<p>El filtrado específico que apliques dependerá de cómo pretendas usar los datos de eBird. Sin embargo, para este ejemplo, filtremos los datos de eBird solo a listas con desplazamiento y estacionarias de 2013-2025 que sean de menos de 6 horas de duración y 10 km de longitud.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>zf_filtered <span class="ot">&lt;-</span> zf <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(observation_date) <span class="sc">&gt;=</span> <span class="dv">2013</span>, <span class="fu">year</span>(observation_date) <span class="sc">&lt;=</span> <span class="dv">2025</span>, <span class="co"># filtramos por años de interés</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>         observation_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Traveling"</span>, <span class="st">"Stationary"</span>), <span class="co"># filtramos por tipo de observación</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>         duration_minutes <span class="sc">&lt;</span> <span class="dv">6</span> <span class="sc">*</span> <span class="dv">60</span>, <span class="co"># filtramos listas que tengan una duración menor a 6 horas</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>         effort_distance_km <span class="sc">&lt;</span> <span class="dv">10</span> <span class="sc">|</span> observation_type <span class="sc">==</span> <span class="st">"Stationary"</span>) <span class="co"># filtramos listas con distancias recorridas menores a 10 km</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(zf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 80577</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(zf_filtered)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 75362</code></pre>
</div>
</div>
<p>Redujimos el número de listas en 5,215 pero las listas restantes son de mayor calidad.</p>
<p>Finalmente, muchas de las columnas en este data frame son innecesarias o redundantes, así que seleccionaremos solo las columnas que necesitamos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>checklists_zf <span class="ot">&lt;-</span> zf_filtered <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(checklist_id, </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>         latitude, longitude,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>         observation_date, time_observations_started,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>         observation_type,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>         duration_minutes, effort_distance_km, number_observers,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>         observation_count, species_observed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-ebird-applications" class="level2">
<h2 class="anchored" data-anchor-id="sec-ebird-applications">Aplicaciones</h2>
<section id="sec-ebird-applications-freq" class="level3">
<h3 class="anchored" data-anchor-id="sec-ebird-applications-freq">Frecuencia de detección</h3>
<p>Lo más simple que podemos hacer con estas observaciones de eBird es estimar la frecuencia de detección del chucao en la región de Los Lagos. Esta es la proporción de listas de eBird en la región que detectaron la especie. <code>species_observed</code> es una columna binaria <code>TRUE/FALSE</code> que indica si se detectó la especie y R trata <code>TRUE</code> como 1 y <code>FALSE</code> como 0, por lo que podemos tomar el promedio de esta columna para obtener la frecuencia de detección.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(checklists_zf<span class="sc">$</span>species_observed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1676972</code></pre>
</div>
</div>
<p>So, Fork-tailed Flycatcher is fairly common within this region with 17% of checklists detecting the species. Detection frequency can be used to compare the prevalence of a species between regions or over time. For example, Fork-tailed Flycatcher is migratory, so let’s look at how detection frequency changes over the months of the year.</p>
<p>Entonces, el chucao es bastante común dentro de esta región, con un 0.17% de las listas detectando la especie. La frecuencia de detección se puede usar para comparar la prevalencia de una especie entre regiones o a lo largo del tiempo. Veamos cómo cambia la frecuencia de detección a lo largo de los meses del año.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>monthly_detection <span class="ot">&lt;-</span> checklists_zf <span class="sc">%&gt;%</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(observation_date)) <span class="sc">%&gt;%</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span> </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">detection_frequency =</span> <span class="fu">mean</span>(species_observed))</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot monthly detection frequency</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(monthly_detection) <span class="sc">+</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> detection_frequency) <span class="sc">+</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Mes del año"</span>,</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Frecuencia de detección"</span>,</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Frecuencia de detección mensual del chucao"</span>,</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Los Lagos, Chile"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ebird_files/figure-html/ebird-applications-freq-monthly-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Based on this chart, Fork-tailed Flycatcher appears to arrive in Rio Grande do Sul in September and depart in February.</p>
<p>Basándose en este gráfico, el chucao parece ser más detectado entre diciembre y marzo.</p>
<div class="callout callout-style-default callout-caution no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Ejercicio
</div>
</div>
<div class="callout-body-container callout-body">
<p>Usa una técnica similar para calcular y graficar el número mensual de listas de eBird en Los Lagos. ¿Hay diferencias entre los meses? Si es así, ¿qué nos dice esto sobre el uso del número de detecciones a partir de datos de solo presencia como una medida de prevalencia?</p>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solución
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Existe una variabilidad en el envío de listas por mes, con menos del doble de listas en enero comparado con junio. Si examináramos el número mensual de detecciones utilizando únicamente datos de presencia, esperaríamos más detecciones en los meses con mayor cantidad de listas, incluso si la prevalencia del chucao permanece constante.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>monthly_checklists <span class="ot">&lt;-</span> <span class="fu">count</span>(checklists_zf, <span class="at">month =</span> <span class="fu">month</span>(observation_date))</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot monthly number of checklists</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(monthly_checklists) <span class="sc">+</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> n) <span class="sc">+</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>), <span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Mes del año"</span>,</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Número de listados en eBird"</span>,</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Listados mensuales subidos a eBird en Los Lagos"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ebird_files/figure-html/ebird-applications-freq-sol-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="sec-ebird-applications-spatial" class="level3">
<h3 class="anchored" data-anchor-id="sec-ebird-applications-spatial">Conversión a formato espacial</h3>
<p>Muchas aplicaciones de datos de eBird requieren convertir los datos en un formato explícitamente espacial, por ejemplo, para hacer un mapa o filtrar las observaciones solo a aquellas dentro de un polígono para un área protegida. El paquete de R <a href="https://r-spatial.github.io/sf/"><code>sf</code></a> se puede usar para representar puntos, líneas y polígonos espaciales en R. Podemos convertir el data frame de las listas a un objeto <code>sf</code> usando la latitud y longitud.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>checklists_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(checklists_zf, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>),</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>                          <span class="co"># 4326 is the code for an unprojected lon/lat</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>                          <span class="co"># coordiante reference system</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(checklists_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 75362 features and 9 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -75.29543 ymin: -43.83669 xmax: -71.68958 ymax: -40.2447
Geodetic CRS:  WGS 84
# A tibble: 75,362 × 10
   checklist_id observation_date time_observations_started observation_type
 * &lt;chr&gt;        &lt;date&gt;           &lt;chr&gt;                     &lt;chr&gt;           
 1 S118804608   2019-01-24       10:00:00                  Traveling       
 2 S116936975   2019-02-16       17:08:00                  Stationary      
 3 S116936842   2019-02-13       10:04:00                  Stationary      
 4 S59435786    2019-09-01       15:09:00                  Traveling       
 5 S58442786    2019-07-25       13:47:00                  Traveling       
 6 S62449405    2019-12-18       16:40:00                  Stationary      
 7 S61589444    2019-11-19       18:18:00                  Traveling       
 8 S61303577    2019-11-09       14:33:00                  Traveling       
 9 S56188483    2019-05-12       14:23:00                  Stationary      
10 S52743789    2019-02-15       20:15:00                  Stationary      
# ℹ 75,352 more rows
# ℹ 6 more variables: duration_minutes &lt;int&gt;, effort_distance_km &lt;dbl&gt;,
#   number_observers &lt;int&gt;, observation_count &lt;int&gt;, species_observed &lt;lgl&gt;,
#   geometry &lt;POINT [°]&gt;</code></pre>
</div>
</div>
<p>Imagina que solo estamos interesados en observaciones dentro de 50 km de Dalcahue, Chile. Podemos usar <code>sf</code> para generar un círculo de radio 50 km centrado en Dalcahue, y luego filtrar las observaciones que caen dentro del círculo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Asignamos las coordenadas de nuestro punto de interés, en este caso las coordenadas de Dalcahue</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>dalcahue_point <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">73.6473</span>, <span class="sc">-</span><span class="fl">42.3796</span>)), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generamos un circulo a partir del punto con un buffer de 50 km</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>dalcahue_circle <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(dalcahue_point, <span class="at">dist =</span> <span class="dv">50000</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtramos los registros que caen dentro del área</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>checklists_dalcahue <span class="ot">&lt;-</span> checklists_sf[dalcahue_circle, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ahora podríamos, por ejemplo, calcular la frecuencia de detección en el área alrededor de Dalcahue.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(checklists_dalcahue<span class="sc">$</span>species_observed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2048135</code></pre>
</div>
</div>
<p>Finalmente, en muchos casos, puede ser más conveniente trabajar con datos de eBird fuera de R en un SIG como <a href="https://qgis.org/en/site/">QGIS</a>, un programa gratuito y de código abierto. Podemos exportar las observaciones de chucao a un GeoPackage usando <code>sf</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_sf</span>(checklists_sf, <span class="st">"data/chutap1-ebird_CL-LL.gpkg"</span>,</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">layer =</span> <span class="st">"chucao_observations"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>El <a href="https://www.geopackage.org/">GeoPackage</a> es una alternativa moderna y de código abierto en formato shapefile para almacenar datos espaciales. Los GeoPackages evitan muchos de los problemas y limitaciones asociados con los shapefiles, y son mucho más eficientes que los shapefiles. La documentación en línea de ArcGIS proporciona <a href="https://desktop.arcgis.com/en/arcmap/latest/manage-data/databases/connect-sqlite.htm">instrucciones sobre cómo abrir un GeoPackage en ArcGIS</a>.</p>
</div>
</div>
</section>
<section id="sec-ebird-applications-mapping" class="level3">
<h3 class="anchored" data-anchor-id="sec-ebird-applications-mapping">Mapeo</h3>
<p>Ahora que tenemos los datos en formato espacial, podemos producir un mapa de los datos de detección/no detección del chucao. Para mapas complejos y altamente personalizados, recomendamos usar un SIG como QGIS que está específicamente diseñado para cartografía. Sin embargo, es posible hacer un mapa rápido y simple en R.</p>
<p>Comenzaremos cargando polígonos que definen las fronteras de países y estados, que proporcionarán información contextual para nuestro mapa. Estos polígonos provienen de <a href="https://www.naturalearthdata.com/downloads/">Natural Earth</a>, una excelente fuente de datos espaciales globales sin atribución. El paquete de R <code>rnaturaleart</code> proporciona acceso a datos de Natural Earth dentro de R; sin embargo, por conveniencia hemos preparado las capas necesarias la clase pasada y además están para descarga en el archivo <code>data/gis-data.gpkg</code> incluido en los archivos para el curso. Proyectaremos todo a una proyección de área igual centrada en la región de Los Lagos, Chile.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>crs <span class="ot">&lt;-</span> <span class="fu">st_crs</span>(<span class="st">"+proj=laea +lat_0=-41 +lon_0=-72.5"</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Polígonos de Natural Earth</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>ne_land <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"data/gis-data-chile.gpkg"</span>, <span class="st">"chile_territorio"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> crs)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>ne_country_lines <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"data/gis-data-chile.gpkg"</span>, <span class="st">"chile_fronteras"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> crs)</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>rgds_boundary <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"data/gis-data-chile.gpkg"</span>, <span class="st">"chile_regiones"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">"Los Lagos"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> crs)</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a><span class="co"># transform ebird data to equal area projection</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>checklists_proj <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(checklists_sf, <span class="at">crs =</span> crs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ahora podemos hacer un mapa de observaciones de chucao en Los Lagos. Construimos el mapa en capas, primero creando un mapa base con los polígonos de Natural Earth, luego graficando los datos de detección y no detección de eBird encima. Al construir un mapa en capas como este, a menudo es útil primero graficar una versión en blanco del conjunto de datos principal que pretendes mapear para definir la extensión espacial del mapa, luego superponer todo lo demás, finalizando con graficar los datos una segunda vez para que aparezcan como la capa superior.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Configuramos los márgenes del gráfico (reducidos para maximizar espacio del mapa)</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="dv">2</span>, <span class="fl">0.25</span>))</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cresmos un gráfico en blanco que define la extensión espacial del mapa. Esto establece los límites del área que queremos mostrar</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(checklists_proj), <span class="at">col =</span> <span class="cn">NA</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregamos las capas de contexto geográfico (de fondo hacia adelante)</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Territorio de Chile (gris claro de fondo)</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ne_land, </span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"#eeeeee"</span>,      <span class="co"># color gris claro para el territorio</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">border =</span> <span class="st">"#888888"</span>,   <span class="co"># borde gris oscuro</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd =</span> <span class="fl">0.5</span>,           <span class="co"># grosor de línea delgado</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">add =</span> <span class="cn">TRUE</span>)          <span class="co"># agregar a gráfico existente</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Región de Los Lagos (gris medio para destacarla)</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rgds_boundary, </span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"#cccccc"</span>,     <span class="co"># color gris medio</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">border =</span> <span class="cn">NA</span>,         <span class="co"># sin borde </span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>     <span class="at">add =</span> <span class="cn">TRUE</span>)         <span class="co"># agregar a gráfico existente</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Fronteras internacionales (líneas negras)</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ne_country_lines, </span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"#000000"</span>,     <span class="co"># color negro para  fronteras</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd =</span> <span class="fl">1.5</span>,          <span class="co"># línea más gruesa</span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>     <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. observaciones de eBird</span></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Listas donde NO se detectó Chucao (puntos grises pequeños)</span></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">filter</span>(checklists_proj, <span class="sc">!</span>species_observed),</span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">19</span>,                          <span class="co"># punto sólido</span></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">0.2</span>,                         <span class="co"># tamaño pequeño</span></span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">"#555555"</span>, <span class="fl">0.5</span>),       <span class="co"># gris semi-transparente</span></span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>     <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in plot.sf(filter(checklists_proj, !species_observed), pch = 19, :
ignoring all but the first attribute</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Listas donde SÍ se detectó Chucao (puntos verdes más grandes)</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">filter</span>(checklists_proj, species_observed),</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">19</span>,                          <span class="co"># punto sólido</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">0.3</span>,                         <span class="co"># tamaño ligeramente mayor</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="fu">alpha</span>(<span class="st">"#4daf4a"</span>, <span class="dv">1</span>),         <span class="co"># verde sólido</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in plot.sf(filter(checklists_proj, species_observed), pch = 19, :
ignoring all but the first attribute</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregamos la leyenda</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomleft"</span>,                   <span class="co"># posición en esquina inferior izquierda</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty =</span> <span class="st">"n"</span>,                       <span class="co"># sin caja alrededor</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"#555555"</span>, <span class="st">"#4daf4a"</span>),   <span class="co"># colores: gris y verde</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Listas de eBird"</span>,    <span class="co"># texto de leyenda</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Avistamientos de Chucao"</span>),</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">19</span>)                        <span class="co"># símbolo: punto sólido</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregsmos el borde y título</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>()                                   <span class="co"># marco alrededor del mapa</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Observaciones de Chucao en eBird (2013-2025)</span><span class="sc">\n</span><span class="st">Región de Los Lagos, Chile"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ebird_files/figure-html/ebird-applications-mapping-map-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="código-para-extraer-datos-del-ebird-basic-dataset-ebd-para-sitios-prioritarios" class="level2">
<h2 class="anchored" data-anchor-id="código-para-extraer-datos-del-ebird-basic-dataset-ebd-para-sitios-prioritarios">Código para extraer datos del eBird Basic Dataset (EBD) para sitios prioritarios</h2>
<p>Este código nos permitirá extraer datos del EBD y resumir la información registrada para un área geográfica de interés utilizando un polígono.</p>
<p>Para correr este código se requieren de tres archivos.</p>
<ol type="1">
<li><p>El eBird Basic Dasaset (EBD) de la región de Los Lagos (<code>ebd_CL-LL_smp_relAug-2025.txt</code>).</p></li>
<li><p>El polígono del área de interés, que en este caso es un área que cubre parte del río Petrohue, Ralún, Chile (<code>ralun.kml</code>). El paquete “sf” utilizado acepta archivos en formato .shp o .kml</p></li>
<li><p><strong>Opcional</strong> Un archivo con nombres locales y categorías de conservación de las especies. En este caso, un archivo con el listado de aves de Chile y su categoría de conservación (<code>lista aves de chile.csv</code>).</p></li>
</ol>
<p>Partimos cargando los paquetes que necesitaremos en esta parte del curso</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(auk)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Luego, importamos los archivos que necesitaremos para trabajar. El set de datos con los que trabajaremos (EBD), en este caso son todos los registros que existen en la región de Los Lagos, el polígono del área de interés y una planilla que contiene información sobre las aves, como sus nombre comunes en español, su estatus en el país y sus categorías de conservación.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># importamos los datos de observaciones</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>f_ebd <span class="ot">&lt;-</span> <span class="st">"data/ebd_CL-LL_smp_relAug-2025.txt"</span> </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>obs <span class="ot">&lt;-</span> <span class="fu">read_ebd</span>(f_ebd)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="co"># en la columna de conteos convertimos los "X" a NA y transformamos el formato a números enteros</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>obs<span class="sc">$</span>observation_count <span class="ot">&lt;-</span> <span class="fu">if_else</span>(obs<span class="sc">$</span>observation_count <span class="sc">==</span> <span class="st">"X"</span>, <span class="cn">NA_character_</span>, </span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>                                 obs<span class="sc">$</span>observation_count) <span class="sc">%&gt;%</span> </span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.integer</span>()</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="co"># cargamos el archivo del polígono, puede ser .shp o .kml </span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>poly <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"data/ralun.kml"</span>) <span class="co">#insertar nombre de archivo propio</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="co"># cargamos la planilla con información de las especies, como su categoría de conservacion</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>cat <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"data/lista aves de chile.csv"</span>)</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a><span class="co"># seleccionamos las columnas que son de nuestro interés</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>cat <span class="ot">&lt;-</span> cat <span class="sc">%&gt;%</span> <span class="fu">select</span>(nombre.científico..Clements., nombre.común, clasificación.IUCN, clasificación.RCE, Chile.total)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Una vez cargados los archivos, filtraremos la base de datos de las observaciones de acuerdo a criterios que uno establezca relacionados al esfuerzo de muestreo, como por ejemplo el tipo de observación realizado, la distancia recorrida, la duración del muestreo o la cantidad de observadores.</p>
<p>Para este ejemplo, filtraremos las listas que presenten distancias recorridas menores a 10 km y menos de seis horas de observación. Además, filtraremos las columnas de nuestro interés y modificaremos las categorías de códigos reproductivos para facilitar la visualización.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>obs_fil <span class="ot">&lt;-</span> obs <span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(protocol_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Traveling"</span>, <span class="st">"Stationary"</span>), <span class="co"># filtramos listas hechas con desplazamiento y estacionarias</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>         duration_minutes <span class="sc">&lt;</span> <span class="dv">6</span> <span class="sc">*</span> <span class="dv">60</span>, <span class="co"># que tengan una duración menor a 6 horas</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>         effort_distance_km <span class="sc">&lt;</span> <span class="dv">10</span> <span class="sc">|</span> protocol_name <span class="sc">==</span> <span class="st">"Stationary"</span>) <span class="co"># con distancias recorridas menores a 10 km</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="co"># seleccionamos solo las columnas necesarias para reducir tamaño del dataframe</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>obs_lim <span class="ot">&lt;-</span> obs_fil <span class="sc">%&gt;%</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sampling_event_identifier,</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>         taxonomic_order,</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>         common_name,</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>         scientific_name,</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>         observation_count,</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>         breeding_category,</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>         latitude,</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>         longitude,</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>         observation_date)</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a><span class="co"># cambiamos la jerarquía de categorias de códigos reproductivos a una jerarquía numérica</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>obs_lim <span class="ot">&lt;-</span> obs_lim <span class="sc">%&gt;%</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">breeding_category =</span> <span class="fu">recode</span>(breeding_category,<span class="st">'C1'</span><span class="ot">=</span><span class="dv">1</span>,<span class="st">'C2'</span><span class="ot">=</span><span class="dv">2</span>,<span class="st">'C3'</span><span class="ot">=</span><span class="dv">3</span>,<span class="st">'C4'</span><span class="ot">=</span><span class="dv">4</span>),</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">breeding_category =</span> <span class="fu">as.integer</span>(<span class="fu">as.character</span>(breeding_category)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Con nuestros archivos preparados, trabajaremos ahora en la sección espacial del código. Partiremos transformando el objeto que contiene las observaciones (<code>obs_lim</code>) a un formato shapefile. Dejaremos ambos objetos con los que trabajaremos (<code>ebd_sf</code> y <code>poly</code>) con el mismo crs. Opcionalmente dejamos explicita la opción de incorporar un buffer al polígono , por si quisiéramos considerar también listados que quedasen justo fuera del polígono, por haber terminado o empezado fuera de este. Finalmente identificaremos y filtraremos los listados que caen dentro del polígono del área de interés.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># transformamos el objeto con las observaciones a formato shape file y le asignamos crs</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>ebd_sf <span class="ot">&lt;-</span> obs_lim <span class="sc">%&gt;%</span> </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(longitude, latitude) <span class="sc">%&gt;%</span> </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co"># transformamos el polígono de nuestra área de interés para tener el mismo crs que el archivo de las observaciones</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>poly_ll <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(poly, <span class="at">crs =</span> <span class="fu">st_crs</span>(ebd_sf))</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="co"># opcionalmente podemos incluir un buffer alrededor del polígono para incluir datos de listas que pudieran haber empezado o terminado fuera del polígono</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>poly_ll_buffer <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(poly_ll, <span class="at">dist =</span> <span class="dv">1000</span>) <span class="co"># en este caso agregamos un buffer de 1km</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>st_as_s2(): dropping Z and/or M coordinate</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># identificamos los puntos (listas) que caen dentro del polígono</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>in_poly <span class="ot">&lt;-</span> <span class="fu">st_within</span>(ebd_sf, poly_ll_buffer, <span class="at">sparse =</span> <span class="cn">FALSE</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co"># filtramos los datos que caen dentro del polígono</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>ebd_in_poly <span class="ot">&lt;-</span> obs_lim[in_poly[, <span class="dv">1</span>], ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finamente, tenemos la base de datos registrados en el área de interés. En esta última parte generaremos una tabla resumen que presente las observaciones del área de manera consisa.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># realizamos una lista de especies registradas, con nombre común, científico y orden taxonómico</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>especie <span class="ot">&lt;-</span>   ebd_in_poly <span class="sc">%&gt;%</span> </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(common_name,scientific_name,taxonomic_order) <span class="sc">%&gt;%</span> </span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(common_name) <span class="sc">%&gt;%</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(common_name, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co"># generamos una lista de especies registradas durante el último año y sus máximos para ese año</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>registro_último_año <span class="ot">&lt;-</span>  ebd_in_poly <span class="sc">%&gt;%</span> </span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(observation_date) <span class="sc">==</span> <span class="fu">year</span>(<span class="fu">max</span>(observation_date))) <span class="sc">%&gt;%</span> </span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(common_name) <span class="sc">%&gt;%</span> </span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(observation_count)) <span class="sc">%&gt;%</span>  <span class="co"># Ordenar en orden descendente de conteo</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(conteo_max_último_año <span class="ot">=</span> <span class="fu">max</span>(observation_count, <span class="at">na.rm=</span><span class="cn">TRUE</span>),<span class="at">checklist.x =</span> <span class="fu">first</span>(sampling_event_identifier),</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>            conteo_max_último_año <span class="ot">=</span> <span class="fu">replace</span>(conteo_max_último_año, conteo_max_último_año <span class="sc">==</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(registro_último_año <span class="ot">=</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 4 warnings in `summarise()`.
The first warning was:
ℹ In argument: `conteo_max_último_año = max(observation_count, na.rm = TRUE)`.
ℹ In group 5: `common_name = "Black-crowned Night Heron"`.
Caused by warning in `max()`:
! no non-missing arguments to max; returning -Inf
ℹ Run `dplyr::last_dplyr_warnings()` to see the 3 remaining warnings.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># resumimos el conteo máximo histórico para cada especie registrada en el polígono</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>conteo_max_h <span class="ot">&lt;-</span> ebd_in_poly <span class="sc">%&gt;%</span> </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(common_name) <span class="sc">%&gt;%</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(observation_count)) <span class="sc">%&gt;%</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span>  <span class="co"># Tomar solo la primera fila (máximo conteo)</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">conteo_max_h =</span> <span class="fu">max</span>(observation_count, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>            año<span class="at">_max_h =</span> <span class="fu">max</span>(<span class="fu">year</span>(observation_date)), </span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">checklist.y =</span> <span class="fu">first</span>(sampling_event_identifier))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 3 warnings in `summarise()`.
The first warning was:
ℹ In argument: `conteo_max_h = max(observation_count, na.rm = TRUE)`.
ℹ In group 8: `common_name = "Black-chested Buzzard-Eagle"`.
Caused by warning in `max()`:
! no non-missing arguments to max; returning -Inf
ℹ Run `dplyr::last_dplyr_warnings()` to see the 2 remaining warnings.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculamos un promedio de conteo en los registros de los últimos 5 años para cada especie</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>prom_conteo_5_años <span class="ot">&lt;-</span> ebd_in_poly <span class="sc">%&gt;%</span> </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">year</span>(observation_date) <span class="sc">&gt;=</span> (<span class="fu">year</span>(<span class="fu">max</span>(observation_date)) <span class="sc">-</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(common_name) <span class="sc">%&gt;%</span> </span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(prom_conteos_5_años <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(observation_count, <span class="at">na.rm=</span><span class="cn">TRUE</span>)))</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co"># asignamos el código reproductivo más alto registrado para cada especie en el polígono</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>cod_rep <span class="ot">&lt;-</span> ebd_in_poly <span class="sc">%&gt;%</span> </span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(common_name) <span class="sc">%&gt;%</span> </span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cod_rep =</span> <span class="fu">max</span>(breeding_category, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">cod_rep =</span> <span class="fu">replace</span>(cod_rep, cod_rep <span class="sc">==</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 59 warnings in `summarise()`.
The first warning was:
ℹ In argument: `cod_rep = max(breeding_category, na.rm = TRUE)`.
ℹ In group 1: `common_name = "Ashy-headed Goose"`.
Caused by warning in `max()`:
! no non-missing arguments to max; returning -Inf
ℹ Run `dplyr::last_dplyr_warnings()` to see the 58 remaining warnings.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># creamos la tabla resumen                                                  </span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>tabla_datos <span class="ot">&lt;-</span> <span class="fu">left_join</span>(especie,registro_último_año, <span class="at">by =</span> <span class="st">"common_name"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(.,conteo_max_h, <span class="at">by =</span> <span class="st">"common_name"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(.,prom_conteo_5_años, <span class="at">by =</span> <span class="st">"common_name"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(.,cod_rep, <span class="at">by =</span> <span class="st">"common_name"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., cat, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"scientific_name"</span> <span class="ot">=</span> <span class="st">"nombre.científico..Clements."</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(common_name) <span class="sc">%&gt;%</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"nombre.común"</span>,<span class="st">"common_name"</span>,<span class="st">"scientific_name"</span>,<span class="st">"registro_último_año"</span>,<span class="st">"conteo_max_último_año"</span>,<span class="st">"checklist.x"</span>,<span class="st">"conteo_max_h"</span>,<span class="st">"año_max_h"</span>,<span class="st">"checklist.y"</span>,<span class="st">"prom_conteos_5_años"</span>,<span class="st">"cod_rep"</span>,<span class="st">"clasificación.RCE"</span>,<span class="st">"clasificación.IUCN"</span>,<span class="st">"taxonomic_order"</span>,<span class="st">"Chile.total"</span>)</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ordenamos la tabla según orden taxonómico, reemplazamos los NAs y los números infinitos por 0</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>tabla_datos <span class="ot">&lt;-</span> tabla_datos <span class="sc">%&gt;%</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(taxonomic_order) <span class="sc">%&gt;%</span> <span class="co"># ordenamos la tabla de acuerdo al orden taxonómico</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(<span class="cf">function</span>(x) <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(x), <span class="dv">0</span>, x)) <span class="sc">%&gt;%</span> <span class="co"># reemplazamos los numeros infinitos por 0, cuando todos los registros de la especie fueron ingresados como 'X' </span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>taxonomic_order)<span class="sc">%&gt;%</span> <span class="co"># quitamos la columna de número taxonómico</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(nombre.inglés <span class="ot">=</span> common_name, <span class="at">nombre.cientifico =</span> scientific_name) <span class="co"># renombramos las columnas para que tengan el mismo idioma y formato </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`mutate_all()` ignored the following grouping variables:
• Column `common_name`
ℹ Use `mutate_at(df, vars(-group_cols()), myoperation)` to silence the message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remplazamos los NA con 0 en columnas numéricas de la tabla resumen</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>tabla_datos <span class="ot">&lt;-</span> tabla_datos <span class="sc">%&gt;%</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(conteo_max_último_año <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(conteo_max_último_año), <span class="dv">0</span>, conteo_max_último_año),</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>         prom_conteos_5_años <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prom_conteos_5_años), <span class="dv">0</span>, prom_conteos_5_años))</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="co"># remplazamos con NA los 0 en las columna de texto</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>tabla_datos<span class="sc">$</span>registro_último_año <span class="ot">&lt;-</span> <span class="fu">replace</span>(tabla_datos<span class="sc">$</span>registro_último_año, <span class="fu">is.na</span>(tabla_datos<span class="sc">$</span>registro_último_año),<span class="cn">FALSE</span>)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="co"># exportamos la tabla resumen como archivo .csv</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(tabla_datos, <span class="st">"datos_eBird_ralun.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Como herramienta adicional, podemos graficar la ubicación de los listados extraidos. esto nos permite revisar la distribución de estos en el área de interés, como también corroborar si el uso del buffer se justifica o si modificamos el tamaño de este.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(poly <span class="sc">%&gt;%</span> <span class="fu">st_geometry</span>(), <span class="at">col =</span> <span class="st">"gray"</span>, <span class="at">border =</span> <span class="cn">NA</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ebd_sf[in_poly[, <span class="dv">1</span>], ], </span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.5</span>, </span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"top"</span>, </span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="st">"Ubicación datos eBird dentro del poligono"</span>,</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">19</span>,</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty =</span> <span class="st">"n"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ebird_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>